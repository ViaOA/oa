


// OASyncServerTest.java

    private ServerRoot readSerializeFromFile() throws Exception {
        File file = new File(OAFile.convertFileName("runtime/test/tsam.bin"));
        if (!file.exists()) {
            return null;
        }
        FileInputStream fis = new FileInputStream(file);
    
        Inflater inflater = new Inflater();
        InflaterInputStream inflaterInputStream = new InflaterInputStream(fis, inflater, 1024*3);
        
        ObjectInputStream ois = new ObjectInputStream(inflaterInputStream) {
            @Override
            protected ObjectStreamClass readClassDescriptor() throws IOException, ClassNotFoundException {
                ObjectStreamClass cd = super.readClassDescriptor();
                /*
                try {
                    Field f = cd.getClass().getDeclaredField("name");
                    f.setAccessible(true);
                    String name = (String) f.get(cd);
                    String name2 = OAString.convert(name, ".tsac.", ".tsac2.");
                    name2 = OAString.convert(name2, "com.", "test.");
                    f.set(cd, name2);
                } catch (Exception e) {
                    throw new RuntimeException(e);
                }
                */
                return cd;
            }
        };

        OAObjectSerializer wrap = (OAObjectSerializer) ois.readObject(); 
        ServerRoot serverRoot = (ServerRoot) wrap.getObject();
        String version = (String) ois.readObject();
        
        ois.close();
        fis.close();

        return serverRoot;
    }
